# 싱글톤 패턴

객체의 인스턴스를 하나만 생성하여 메모리에 할당하는 패턴
만약 새로운 인스턴스를 생성한다면 기존의 인스턴스를 반환한다.

## 장점

- 인스턴스를 하나만 만들어 메모리 절약할 수 있음
- 글로벌한 인스턴스로 데이터 공유가 쉬움
  - 동시성 문제가 생길 수 있음(동시에 데이터에 접근해 발생하는 문제)

## 단점

- 테스트가 어려움
  - 데이터를 공유하기 때문에 테스트 시 매번 인스턴스의 상태를 초기화해야함

## 자바스크립트에서 싱글톤 패턴

자바와 같은 언어에서는 객체를 만들기 위해서는 반드시 클래스를 작성하고 인스턴스를 생성해야한다. 그에 반해 자바스크립트에서는 클래스 없이 객체를 직접 만들어낼 수 있다.

아래와 같이 객체의 참조값을 export하면 싱글톤 패턴과 같은 효과를 누린다.

```js
let count = 0;

const counter = {
  increment() {
    return ++count;
  },
  decrement() {
    return --count;
  },
};

Object.freeze(counter);
export { counter };
```

## Node.js 모듈은 싱글톤

Node.js 모듈은 동일로 파일로 해석하는 경우 싱글톤으로 동작한다.

- "resolved filename"(해결된 파일 이름) 개념을 이해해야 캐싱 예외를 이해할 수 있다.
  - 해결된 파일 이름은 "로드된 모듈의 절대 파일 경로"이다.
  - 해결된 파일 이름은 캐시 키로 사용된다.
- counter.js와 COUNTER.js는 같은 파일을 가르킬 수 있지만, 캐시 키는 다르다.
  - 파일 시스템이나 운영체제는 대소문자를 구분하지 않고 같은 파일을 가리킬 수 있다.
  - 하지만 해결된 파일이름은 캐시 키로 사용되기 때문에 대소문자를 구분한다.

```js
const counter1 = require("./counter.js");
const counter2 = require("./COUNTER.js");

// 파일 시스템은 대소문자를 구분하지않고 같은 파일을 가르킨다.

counter1.increment();

// 하지만 Node.js가 모듈을 싱글톤 패턴을 사용하기 위해서는 캐시 키로 모듈의 절대 파일 경로를 사용한다.
// 때문에 counter1과 counter2는 다른 모듈(코드조각)으로 인식된다

console.log(counter1.get()); // 0
console.log(counter2.get()); // 1
```

## Redux와 싱글톤

싱글톤은 인스턴스의 값을 직접 수정할 수 있는것에 반해 Redux와 같은 flux 패턴은 상태를 "읽기 전용"으로만 제공하고 순수함수 리듀서를 통해서만 상태를 업데이트하기 때문에 싱글톤이라 볼수 없다. (인스턴스를 제공하는 것이 아님)
